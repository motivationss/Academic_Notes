\lecture{33}{1 Apr. 11:00}{Monotone Differentiation Theorem}
\begin{prev}
	We have that if \(\rho \ll m\) is \hyperref[def:regular]{regular} then
	\[
		\lim_{r \to 0} \frac{\rho(E_r)}{m(E_r)} = \frac{\,\mathrm{d}\rho}{\,\mathrm{d}m}(x)
	\]
	for \hyperref[def:mu-almost-everywhere]{Lebesgue almost every \(x\)}, where \(\{E_r\}\) \hyperref[def:shrink-nicely]{shrinks nicely} to \(x\).
	Likewise, if \(\lambda \perp m\) \hyperref[def:regular]{regular} (\hyperref[def:signed-measure]{positive measure}) then
	\[
		\lim_{r \to 0} \frac{\lambda(E_r)}{m(E_r)} = 0
	\]
	for \hyperref[def:mu-almost-everywhere]{Lebesgue almost every \(x\)}, where \(\{E_r\}\) \hyperref[def:shrink-nicely]{shrinks nicely} to \(x\).
\end{prev}

From this, we can easily deduce the following important result.
\begin{theorem}[Lebesgue differentiation theorem for regular measures]\label{thm:Lebesgue-differentiation-theorem-for-regular-measure}
	Let \(\nu\) be a \hyperref[def:regular]{regular}  \hyperref[def:signed-measure]{\hyperref[def:Borel-measure]{Borel} signed measure} on \(\mathbb{\MakeUppercase{r}} ^d\).
	Then \(\,\mathrm{d}\nu = \,\mathrm{d}\lambda + f \,\mathrm{d}m\), \(\lambda \perp m\) by \autoref{thm:Lebesgue-Radon-Nikodym-theorem}.
	Then for \hyperref[def:mu-almost-everywhere]{Lebesgue almost every} \(x\),
	\[
		\lim_{r \to 0} \frac{\nu(E_r)}{m(E_r)} = f(x)
	\]
	for every \(\{E_r\}\) \hyperref[def:shrink-nicely]{shrinks nicely} to \(x\).
\end{theorem}
\begin{proof}
	It must be checked that \(\nu\) \hyperref[def:regular]{regular} implies \(\lambda, f \,\mathrm{d}m\) are \hyperref[def:regular]{regular}.\todo{Check!}
	In particular, since \(f\in L^1_{\mathrm{loc} } \), so from \autoref{thm:Lebesgue-differentiation-theorem} and its corollary (\autoref{col:lec-22-1}, \autoref{col:lec-22-2}),
	we see that it suffices to show that if \(\lambda \) is \hyperref[def:regular]{regular} and \(\lambda \perp m\),
	then for Lebesgue \hyperref[def:mu-almost-everywhere]{a.e.} \(x\),
	\[
		\lim\limits_{r \to 0} \frac{\lambda (E_{r} )}{m(E_{r} )}\to 0
	\]
	when \(\{E_{r} \}\) \hyperref[def:shrink-nicely]{shrinks nicely to \(x\)}. It also suffices to take \(E_{r} = B(r, x)\) and to assume that \(\lambda \) is
	\hyperref[def:signed-measure]{positive}, since for some \(\alpha >0\), we have
	\[
		\left\vert \frac{\lambda (E_{r} )}{m(E_{r} )} \right\vert
		\leq \frac{\left\vert \lambda \right\vert(E_{r} ) }{m(E_{r} )}
		\leq \frac{\left\vert \lambda \right\vert(B(r, x)) }{m(E_{r} )}
		\leq \frac{\left\vert \lambda \right\vert(B(r, x)) }{\alpha m(B(r, x))}.
	\]
	Therefore, if \(\left\vert \lambda \right\vert(E_{r} ) / m(E_{r} ) \to 0\), so does \(\left\vert \lambda (E_{r} ) / m(E_{r} ) \right\vert \),
	hence \(\lambda (E_{r} ) / m(E_{r} )\). We see that the result then follows directly from \autoref{prop:lec-32}.
\end{proof}

\section{Monotone Differentiation Theorem}
We first formalize one ambiguous notation we used long time ago with discussing \hyperref[def:distribution-function]{distribution function}.
Namely, \(F(x^+), F(x^-)\).
\begin{definition*}
	For an \(F \colon  \mathbb{R} \to \mathbb{R}\) that is monotonically increasing, we have the following.
	\begin{definition}[\(F(x^+)\)]\label{def:x-plus}
		We define \(F(x^+) = \lim\limits_{y \to x^+} F(y)\).
	\end{definition}
	\begin{definition}[\(F(x^-)\)]\label{def:x-minus}
		We define \(F(x^-) = \lim\limits_{y \to x^-} F(y)\).
	\end{definition}
\end{definition*}
\begin{remark}
	If \(F\) is monotonically increasing, then \(F(x^+), F(x^-)\) exist and are
	\[
		\inf_{y > x} F(y),\quad \sup_{y < x} F(y)
	\]
	respectively since it's bounded below/above respectively by \(F(x)\).
\end{remark}
\begin{lemma}\label{lma:lec-33}
	If \(F\colon \mathbb{\MakeUppercase{r}} \to \mathbb{\MakeUppercase{r}} \) is monotonically increasing, then
	\[
		D = \{x\in \mathbb{\MakeUppercase{r}}  \mid F \text{ is discontinuous at } x\}
	\]
	is a countable set.
\end{lemma}
\begin{proof}
	Since \(F\) is monotonically increasing, \(x \in D\) if and only if \(F(x^+) > F(x^-)\). For each \(x \in D\), let \(I_x = (F(x^-),F(x^+))\), not empty.
	Also, if \(x,y \in D\), \(x \neq y\), then \(I_x,I_y\) are disjoint. Now, for \(\left\vert x \right\vert < N\), \(I_x\) lies in the interval
	\((F(-N), F(N))\). Hence,
	\[
		\sum\limits_{\left\vert x \right\vert < N}\left[F(x^+) - F(x^-)\right] \leq F(N) - F(-N) <\infty,
	\]
	which implies that
	\[
		D \cap (-N, N) = \left\{x\in (-N, N) \mid F(x^+) \neq F(x^-)\right\}
	\]
	is countable. Since this is true for all \(N\), the result follows.
\end{proof}

\begin{theorem}[Monotone differentiation theorem]\label{thm:monotone-differentiation}
	Let \(F\) be an increasing function, then
	\begin{itemize}
		\item \(F\) is differentiable \hyperref[def:Lebesgue-measure]{Lebesgue} \hyperref[def:mu-almost-everywhere]{almost everywhere}.
		\item \(G(x) \coloneqq F(x^+)\)\footnote{Observe that \(G\) is increasing and right-continuous.} is differentiable \hyperref[def:mu-almost-everywhere]{almost everywhere}.
		\item \(G^\prime  = F^\prime \) \hyperref[def:mu-almost-everywhere]{almost everywhere}
	\end{itemize}
\end{theorem}
\begin{proof}
	Start with \(G(x)\coloneqq F(x^+)\), which is increasing and right-continuous on \(\mathbb{R}\). There is then a
	\hyperref[def:Lebesgue-Stieltjes-measure]{Lebesgue-Stieltjes measure}
	\(\mu_G\) on \(\mathbb{R}\), thus it is \hyperref[def:regular]{regular} on \(\mathbb{R}\). We see
	\[
		\frac{G(x+h) - G(x)}{h} = \begin{dcases}
			\frac{\mu _{G} ((x, x+h])}{m((x, x+h])}, & \text{ if } h>0 ; \\
			\frac{\mu _{G} ((x+h, x])}{m((x+h, x])}, & \text{ if } h<0 .
		\end{dcases}
	\]
	Note that both \(\{(x, x+h]\}\) and \(\{(x+h, x]\}\) \hyperref[def:shrink-nicely]{shrink nicely} to \(x\) as \(\left\vert h \right\vert \to 0\).
	By \autoref{thm:Lebesgue-differentiation-theorem-for-regular-measure} (since these \hyperref[def:shrink-nicely]{shrink nicely}), we
	then know that these both converge for \hyperref[def:Lebesgue-measure]{Lebesgue} \hyperref[def:mu-almost-everywhere]{almost every \(x\)} to some common limit \(f(x)\).
	Hence, \(G^\prime\) exists \hyperref[def:Lebesgue-measure]{Lebesgue} \hyperref[def:mu-almost-everywhere]{almost everywhere}. We now show that by defining \(H \coloneqq G - F\),
	\(H^\prime \) exists and equals zero \hyperref[def:mu-almost-everywhere]{a.e.}

	Observe that \(H(x) = G(x) - F(x) \geq 0\), and we see that
	\[
		\{x \mid H(x) > 0\} \subseteq \{x \mid F \text{ is discontinuous at } x\}.
	\]
	The latter set is then countable by \autoref{lma:lec-33}, hence we can write \(\{x \mid H(x) > 0\} = \{x_n\}\). Then let
	\[
		\mu \coloneqq \sum_n H(x_n) \delta_{x_n}.
	\]
	This is a \hyperref[def:Borel-measure]{Borel measure}, so we check if it is \hyperref[def:locally-finite]{locally finite}. Indeed, since
	\[
		\mu((-N,N)) = \sum_{-N < x_n < N} H(x_n) \leq G(N) - F(-N) < \infty,
	\]
	where checking the inequality just consists of seeing that the intervals \((F(x_n), G(x_n))\) are disjoint and is a subset of \((F(-N),G(N))\), so
	\[
		\sum_{-N < x_n < N} H(x_n) = \mu\left( \bigcup_n (F(x_n), G(x_n)) \right) \leq \mu((F(-N),G(N))).
	\]

	Thus, \(\mu\) is a \hyperref[def:Lebesgue-Stieltjes-measure]{Lebesgue-Stieltjes measure} on \(\mathbb{R}\), so it is \hyperref[def:regular]{regular}.
	\begin{remark}
		Special to \(\mathbb{R}\), we have that for a \hyperref[def:measure]{measure},
		\[
			\text{\hyperref[def:locally-finite]{locally finite} \hyperref[def:Borel-measure]{Borel}}
			\implies \text{\hyperref[def:Lebesgue-Stieltjes-measure]{Lebesgue-Stieltjes}}
			\implies \text{\hyperref[def:regular]{regular}}
			\implies \text{\hyperref[def:regular-outer-regularity]{outer regularity}}.
		\]
	\end{remark}
	Also, we have \(\mu \perp m\) since \(m(E) = \mu (E^{c} ) = 0\) where \(E = \{x_n\}\). Then we have that
	\[
		\left\vert \frac{H(x + h) - H(x)}{h} \right\vert \leq \frac{H(x + h) + H(x)}{\left\vert h \right\vert} \leq \frac{\mu((x-2h,x+2h))}{\left\vert h \right\vert},
	\]
	which  goes to \(0\) for \hyperref[def:Lebesgue-measure]{Lebesgue} \hyperref[def:mu-almost-everywhere]{almost every \(x\)} by
	\autoref{thm:Lebesgue-differentiation-theorem-for-regular-measure} and that \(\mu \perp m\).

	Thus, \(H\) is differentiable \hyperref[def:mu-almost-everywhere]{almost everywhere} and \(H^\prime = 0\) \hyperref[def:mu-almost-everywhere]{almost everywhere},
	which implies \(F\) is differentiable \hyperref[def:mu-almost-everywhere]{almost everywhere} and \(F^\prime = G^\prime\) \hyperref[def:mu-almost-everywhere]{almost everywhere}.
\end{proof}

\begin{proposition}\label{prop:FTC-inequality}
	Suppose \(F\) is an increasing function, then \(F^\prime\) exists \hyperref[def:mu-almost-everywhere]{almost everywhere} and is
	\hyperref[def:measurable-function]{measurable}, then
	\[
		\int_a^b F^\prime (x) \,\mathrm{d}x \leq F(b) - F(a).
	\]
\end{proposition}

\begin{eg}
	The inequality can't be made into equality in \autoref{prop:FTC-inequality} by the given condition.
\end{eg}
\begin{explanation}
	Take \(F(x)\) as
	\[
		F(x) \coloneqq \begin{dcases}
			0, & \text{ if } x\leq 0 ; \\
			1, & \text{ if } x > 0.
		\end{dcases}
	\]
	Then \(F^\prime(x) = 0\) \hyperref[def:mu-almost-everywhere]{almost everywhere}. So
	\[
		\int_{-1}^1 F^\prime(x) \,\mathrm{d}x = 0 < 1 = F(1) - F(-1).
	\]
\end{explanation}

\begin{eg}
	The inequality can't be made into equality in \autoref{prop:FTC-inequality} even if \(F\) is continuous in addition.
\end{eg}
\begin{explanation}
	Take \(F(x)\) to be the \hyperref[sssec:Cantor-Function]{Cantor function}.
	Then \(F^\prime(x) = 0\) \hyperref[def:mu-almost-everywhere]{almost everywhere}, but
	\[
		\int_0^1 F^\prime(x) \,\mathrm{d}x = 0 < 1 = F(1) - F(0).
	\]
\end{explanation}